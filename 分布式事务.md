# 分布式事务设计方案
- 可靠消息生产 - 记录消息发送
~~~
消息保存记录
发布确认机制
~~~
- 可靠消息生成 - 修改消息发送状态
- 可靠消息处理 - 正常处理
~~~
手动ack
幂等性：防止重复操作，一次用户操作，只对应一次数据处理
~~~
- 可靠消息处理 - 消息丢弃
~~~
消费者处理失败，直接丢弃或转移到死信队列
~~~

### 分布式解决方案理论依据
- CAP理论
~~~
是在一个分布式系统中，一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance）
~~~
- BASE理论
~~~
是指基本可用（Basically Available）、软状态（ Soft State）、最终一致性（ Eventual Consistency）
~~~
- 2PC协议
~~~
是Two-Phase Commit的缩写，即二阶段提交
~~~
- 3PC协议
~~~
是Three-Phase Commit的缩写，即三阶段提交，是2PC的改进版，将2PC的“提交事务请求”（即2PC第一阶段）过程一分为二，形成了由canCommit、preCommit、doCommit三阶段组成的事务处理协议
~~~
- Paxos算法
~~~
解决的问题是一个分布式系统如何就某个值（决议）达成一致。一个典型的场景是，在一个分布式数据库系统中，如果各节点的初始状态一致，每个节点执行相同的操作序列，那么他们最后能得到一个一致的状态。为保证每个节点执行相同的命令序列，需要在每一条指令上执行一个“一致性算法”以保证每个节点看到的指令一致。一个通用的一致性算法可以应用在许多场景中，是分布式计算中的重要问题。因此从20世纪80年代起对于一致性算法的研究就没有停止过。节点通信存在两种模型：共享内存（Shared memory）和消息传递（Messages passing）。Paxos 算法就是一种基于消息传递模型的一致性算法。
~~~
- Raft一致性协议
~~~
在Raft中，任何时候一个服务器可以扮演下面角色之一：

Leader: 处理所有客户端交互，日志复制等，一般一次只有一个Leader.
Follower: 类似选民，完全被动
Candidate候选人: 类似Proposer律师，可以被选为一个新的领导人。
~~~
